// <auto-generated>
// 由 Core/Tools/BridgeGen 生成，请勿手改。
// </auto-generated>

using Bridge.Core;

namespace Bridge.Bindings
{
    /// <summary>
    /// 单次扫描 command stream，并按 func_id 分发到各模块 Host API。
    /// </summary>
    public static class BridgeAllCommandDispatcher
    {
        public static unsafe void Dispatch<THost>(CommandStream stream, THost host)
            where THost : class, DemoAsset.Bindings.IDemoAssetHostApi, DemoEntity.Bindings.IDemoEntityHostApi, DemoLog.Bindings.IDemoLogHostApi
        {
            if (stream.IsEmpty || host == null)
                return;

            byte* cursor = (byte*)stream.Ptr;
            byte* end = cursor + (int)stream.Length;

            while (cursor < end)
            {
                long remaining = end - cursor;
                if (remaining < sizeof(BridgeCommandHeader))
                    break;

                var header = (BridgeCommandHeader*)cursor;
                int size = header->Size;
                if (size <= 0)
                    break;
                if (size < sizeof(BridgeCommandHeader) || size > remaining)
                    break;

                if (header->Type == (ushort)BridgeCommandType.CallHost && size >= sizeof(BridgeCmdCallHost))
                {
                    var cmd = (BridgeCmdCallHost*)cursor;
                    uint payloadSize = cmd->PayloadSize;
                    if (payloadSize <= (uint)(size - sizeof(BridgeCmdCallHost)))
                    {
                        byte* payloadPtr = cursor + sizeof(BridgeCmdCallHost);

                        switch (cmd->FuncId)
                        {
                            case 0x82A5E93Au:
                            {
                                if (payloadSize == (uint)sizeof(DemoAsset.Bindings.HostArgs_LoadAsset))
                                {
                                    var a = *((DemoAsset.Bindings.HostArgs_LoadAsset*)payloadPtr);
                                    host.LoadAsset(a.RequestId, a.AssetType, a.AssetKey.ToManagedString());
                                }
                                break;
                            }
                            case 0xBCAA331Du:
                            {
                                if (payloadSize == (uint)sizeof(DemoEntity.Bindings.HostArgs_SpawnEntity))
                                {
                                    var a = *((DemoEntity.Bindings.HostArgs_SpawnEntity*)payloadPtr);
                                    host.SpawnEntity(a.EntityId, a.PrefabHandle, a.Transform, a.Flags);
                                }
                                break;
                            }
                            case 0x20DA0B6Fu:
                            {
                                if (payloadSize == (uint)sizeof(DemoEntity.Bindings.HostArgs_SetTransform))
                                {
                                    var a = *((DemoEntity.Bindings.HostArgs_SetTransform*)payloadPtr);
                                    host.SetTransform(a.EntityId, a.Mask, a.Transform);
                                }
                                break;
                            }
                            case 0xC7C1C59Cu:
                            {
                                if (payloadSize == (uint)sizeof(DemoEntity.Bindings.HostArgs_DestroyEntity))
                                {
                                    var a = *((DemoEntity.Bindings.HostArgs_DestroyEntity*)payloadPtr);
                                    host.DestroyEntity(a.EntityId);
                                }
                                break;
                            }
                            case 0xDA3184A2u:
                            {
                                if (payloadSize == (uint)sizeof(DemoLog.Bindings.HostArgs_Log))
                                {
                                    var a = *((DemoLog.Bindings.HostArgs_Log*)payloadPtr);
                                    host.Log(a.Level, a.Message.ToManagedString());
                                }
                                break;
                            }
                        }
                    }
                }

                cursor += size;
            }
        }
    }
}
